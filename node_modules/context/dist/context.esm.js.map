{"version":3,"file":"context.esm.js","sources":["../src/index.ts"],"sourcesContent":["export default function createContext<T extends Record<string, any>>(\n  init?: (ctxRef: T, parentContext: T | void) => T | null\n) {\n  const storage: { ctx?: T; ancestry: T[] } = { ancestry: [] };\n\n  return {\n    run,\n    bind,\n    use,\n  };\n\n  function run<R>(ctxRef: T, fn: (context: T) => R): R {\n    const parentContext = use();\n\n    const out = {\n      ...(parentContext ? parentContext : {}),\n      ...(init?.(ctxRef, parentContext) ?? ctxRef),\n    };\n\n    const ctx = set(Object.freeze(out));\n    storage.ancestry.unshift(ctx);\n    const res = fn(ctx);\n\n    clear();\n    return res;\n  }\n\n  function bind<R>(ctxRef: T, fn: (...args: any[]) => R, ...args: any[]) {\n    return function(...runTimeArgs: any[]) {\n      return run<R>(ctxRef, function() {\n        return fn(...args, ...runTimeArgs);\n      });\n    };\n  }\n\n  function use() {\n    return storage.ctx;\n  }\n\n  function set(value: T): T {\n    return (storage.ctx = value);\n  }\n\n  function clear() {\n    storage.ancestry.shift();\n    set(storage.ancestry[0] ?? null);\n  }\n}\n"],"names":["createContext","init","storage","ancestry","run","bind","use","ctxRef","fn","parentContext","out","ctx","set","Object","freeze","unshift","res","clear","args","runTimeArgs","value","shift"],"mappings":";;;;;;;;;;;;;;;;;;SAAwBA,cACtBC;AAEA,MAAMC,OAAO,GAA+B;AAAEC,IAAAA,QAAQ,EAAE;AAAZ,GAA5C;AAEA,SAAO;AACLC,IAAAA,GAAG,EAAHA,GADK;AAELC,IAAAA,IAAI,EAAJA,IAFK;AAGLC,IAAAA,GAAG,EAAHA;AAHK,GAAP;;AAMA,WAASF,GAAT,CAAgBG,MAAhB,EAA2BC,EAA3B;;;AACE,QAAMC,aAAa,GAAGH,GAAG,EAAzB;;AAEA,QAAMI,GAAG,gBACHD,aAAa,GAAGA,aAAH,GAAmB,EAD7B,WAEHR,IAFG,aAEHA,IAFG,uBAEHA,IAAI,CAAGM,MAAH,EAAWE,aAAX,CAFD,yCAE8BF,MAF9B,CAAT;;AAKA,QAAMI,GAAG,GAAGC,GAAG,CAACC,MAAM,CAACC,MAAP,CAAcJ,GAAd,CAAD,CAAf;AACAR,IAAAA,OAAO,CAACC,QAAR,CAAiBY,OAAjB,CAAyBJ,GAAzB;AACA,QAAMK,GAAG,GAAGR,EAAE,CAACG,GAAD,CAAd;AAEAM,IAAAA,KAAK;AACL,WAAOD,GAAP;AACD;;AAED,WAASX,IAAT,CAAiBE,MAAjB,EAA4BC,EAA5B;sCAA0DU;AAAAA,MAAAA;;;AACxD,WAAO;yCAAYC;AAAAA,QAAAA;;;AACjB,aAAOf,GAAG,CAAIG,MAAJ,EAAY;AACpB,eAAOC,EAAE,MAAF,SAAMU,IAAN,QAAeC,WAAf,EAAP;AACD,OAFS,CAAV;AAGD,KAJD;AAKD;;AAED,WAASb,GAAT;AACE,WAAOJ,OAAO,CAACS,GAAf;AACD;;AAED,WAASC,GAAT,CAAaQ,KAAb;AACE,WAAQlB,OAAO,CAACS,GAAR,GAAcS,KAAtB;AACD;;AAED,WAASH,KAAT;;;AACEf,IAAAA,OAAO,CAACC,QAAR,CAAiBkB,KAAjB;AACAT,IAAAA,GAAG,uBAACV,OAAO,CAACC,QAAR,CAAiB,CAAjB,CAAD,mEAAwB,IAAxB,CAAH;AACD;AACF;;;;"}